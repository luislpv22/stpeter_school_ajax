<!DOCTYPE html>
<html>
<head>
	<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>St. Peter School - Página principal</title>

	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
	<link rel="stylesheet" type="text/css" href="css/panel.css">
	<link rel="stylesheet" type="text/css" href="css/estiloGestionMatricula.css">
	<script>
		if (typeof sessionStorage.usuario === 'undefined')
			location.href = "login.html";
	</script>
</head>
<body>
	<div class="wrapper">
		<nav id="sidebar">
			<!-- Sidebar Header -->
			<div class="sidebar-header">
				<h3>St. Peter School</h3>
				<strong>St.P</strong>
			</div>

			<div class="usuario">
				<div class="nombre"></div>
				<button id="btnCerrarSesion" name="btnCerrarSesion" class="btn btn-default btn-sm">Cerrar Sesión</button>
			</div>

			<!-- Sidebar Links -->
			<ul class="list-unstyled components">
				<li class="active">
					<a href="#frmModUsuario" id="enlaceMisDatos"><i class="glyphicon glyphicon-user"></i>Mis Datos</a>
				</li>
				<li>
					<a href="#frmAltaMatri" id="enlaceMatricular"><i class="glyphicon glyphicon-education"></i>Matricularme</a>
				</li>
				<li>
					<a href="#pageSubmenu1" data-toggle="collapse" aria-expanded="false"><i class="glyphicon glyphicon-book"></i>Cursos</a>
					<ul class="collapse list-unstyled" id="pageSubmenu1">
					</ul>
				</li>

				<li><a href="#capaDarBaja" id="enlaceBaja"><i class="glyphicon glyphicon-remove"></i>Darme de baja</a></li>
			</ul>
		</nav>

		<div id="content">
			<!--<button type="button" id="sidebarCollapse" class="btn btn-default navbar-btn"><i class="glyphicon glyphicon-menu-hamburger"></i></button>--><br/>

			<!-- hasta aqui todo lo relacionado con el menú -->

			<div class="container-fluid">
				<!-- formulario modificar datos alumno -->
				<div id="capaModificarAlu" class="ocultar">
					<form class="form-horizontal" name="frmModUsuario" id="frmModUsuario" action="#">
						<fieldset>
							<legend>Modificar datos</legend>
							<br/>
							<div class="form-group" id="mod">
								<label class="col-md-2 control-label" for="nombreAlu">Nombre:</label>  
								<div class="col-md-4">
									<input id="nombreUsu" name="nombreUsu" type="text" placeholder="nombre" class="form-control input-md" disabled >

								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-2 control-label" for="apellidosAlu">Apellidos:</label>  
								<div class="col-md-4">
									<input id="apellidosUsu" name="apellidosUsu" type="text" placeholder="apellidos" class="form-control input-md" disabled>

								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-2 control-label" for="dniAlu">DNI:</label>  
								<div class="col-md-4">
									<input id="dniUsu" name="dniUsu" type="text" placeholder="dni" class="form-control input-md" disabled>

								</div>
							</div>

							<!-- password input-->
							<div class="form-group">
								<label class="col-md-2 control-label" for="password">Password:</label>  
								<div class="col-md-4">
									<input id="passUsu" name="passUsu" type="password" placeholder="password" class="form-control input-md" required="">
								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-2 control-label" for="telefonoAlu">Teléfono:</label>  
								<div class="col-md-4">
									<input id="telefonoUsu" name="telefonoUsu" type="text" placeholder="teléfono" class="form-control input-md" required="">

								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-2 control-label" for="direAlu">Dirección:</label>  
								<div class="col-md-4">
									<input id="direUsu" name="direUsu" type="text" placeholder="dirección" class="form-control input-md" required="">

								</div>
							</div>

							<!-- Text input-->
							<div class="form-group">
								<label class="col-md-2 control-label" for="emailAlu">Email:</label>  
								<div class="col-md-4">
									<input id="emailUsu" name="emailUsu" type="text" placeholder="email" class="form-control input-md" required="">

								</div>
							</div>

							<!-- Button (Double) -->
							<div class="form-group">
								<label class="col-md-2 control-label" for="ModAlu"></label>
								<div class="col-md-4">
									<button id="btnModDatosUsu" name="btnModDatosUsu" class="btn btn-success">Modificar datos</button>
								</div>
							</div>

						</fieldset>
					</form>
				</div>

				<!--  - - - - - - - - - - - - - - - - - - - -->

				<!-- - Matricular curso -->
				<div id="capaMatriCurso" class="ocultar">
					<form action="#" method="post" name="frmAltaMod" id="frmAltaMod">
						<fieldset>
							<!-- Form Name -->
							<legend>Matriculación</legend>

							<div class="container-fluid">
								<div class="form-horizontal">
									<!--contenido de la matriculación-->
									<div class="form-group">
										<label class="col-md-2 control-label" for="selectIdioma">Idiomas</label>
										<div class="col-md-3">
											<select id="selectIdioma" name="selectIdioma" class="form-control">
												<option value="seleIdi">Seleccione Idioma</option>
											</select>
										</div>
									</div>

									<div class="form-group">
										<label class="col-md-2 control-label" for="selectNivel">Nivel</label>
										<div class="col-md-3">
											<select id="selectNivel" name="selectNivel" class="form-control">
												<option value="seleNi">Seleccione Idioma</option>
											</select>
										</div>
									</div>

									<div class="form-group">
										<label class="col-md-2 control-label" for="selectTipo">Tipo</label>
										<div class="col-md-3">
											<select id="selectTipo" name="selectTipo" class="form-control" disabled>
												<option value="seleTipo">Seleccione Tipo</option>
											</select>
										</div>
									</div>

									<div class="form-group">
										<label class="col-md-2 control-label" for="duraCurso">Duración del curso</label>  
										<div class="col-md-3">
											<input id="duraCurso" name="duraCurso" type="text" class="form-control input-md" disabled>
										</div>
									</div>
									<div class="form-group">
										<label class="col-md-2 control-label" for="preCurso">Precio del curso</label>  
										<div class="col-md-3">
											<input id="preCurso" name="preCurso" type="text" class="form-control input-md" disabled>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-2"></div>
										<div class="col-md-3">
											<button type="button" id="btnAddCursoMatri" name="btnAddCursoMatri" class="btn btn-primary" disabled>Seleccionar</button>
										</div>
									</div>
								</div>


								<div id="txtInformacion" class="alert alert-dismissible hide"><span></span><button type="button" class="close" data-dismiss="alert">&times;</button></div>

								<table id="tablaMatriCurso" class="table table-hover">
									<thead>
										<tr>
											<th>Tipo curso</th>
											<th>Idioma</th>
											<th>Nivel</th>
											<th>Duración</th>
											<th>Precio</th>
										</tr>
									</thead>
								</table>

								<div id="capaBotonesMatri">
									<div class="form-group">
										<label class="col-md-4 control-label" for="altaAlu"></label>
										<div class="col-md-8">
											<button id="btnEnviarMatri" name="btnEnviarMatri" class="btn btn-success" disabled>Matricular</button>
										</div>
									</div>
								</div>
							</div>
						</fieldset>
					</form>
				</div>

				<!-- - dar de baja academia -->
				<div id="capaDarBaja" class="ocultar">
					<h4> La siguiente acción te dará de baja en la academia, ¿estás seguro?</h4>
					<div class="form-group">
						<label class="col-md-4 control-label" for="addCursoMatri"></label>
						<div  id="botonAddCurso" class="col-md-4">
							<button id="btnDarBajaAca" name="btnDarBajaAca" class="btn btn-danger">Dar de baja</button>
						</div>
					</div>
				</div>
				<!--  - - - - - - - - - - - - - - - - - - - -->

				<div id="listaCalificaciones" class="ocultar col-md-12">
				</div>

				<!-- - panel de mensajes -->
				<div class="panel panel-default" id="panelMensajes">
					<div class="panel-heading">
						<h3 class="panel-title">Mensajes</h3>
					</div>
					<div class="panel-body" id="divTextoMensaje">
						<p id="pTextoMensaje"></p>
						<div class="form-group">
							<div class="col-md-4">
								<input type="button" id="btnCerrar" name="btnCerrar" class="btn btn-primary" value="CerrarMensaje"/>
							</div>
						</div>
					</div>
				</div>
				<!-- - - - - - - - - - - - - - -->
			</div>
		</div>
	</div>

	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/objetos.js"></script>
	<script type="text/javascript" src="js/principal.js"></script>
	<script type="text/javascript" src="js/alumno.js"></script>
	<script type="text/javascript" src="js/validaciones.js"></script>
	<script>

		if (typeof(sesion) === "undefined")
			var sesion = JSON.parse(sessionStorage.usuario);

		document.querySelector('#sidebar .usuario .nombre').appendChild(document.createTextNode(sesion.nombre));

		if (sesion.tipo != 'alumno')
			location.href = "index.html";

		var btnCerrarSesion= document.querySelector("#btnCerrarSesion");
		btnCerrarSesion.addEventListener("click", cerrarSesion, false);

		/*zona de configuración de eventos*/

		var enlaces = document.getElementsByTagName("a");
		for (var i = 0; i < enlaces.length ; i++) 
		{  
			enlaces[i].addEventListener("click", function (event)
			{
				event.preventDefault();
				mostrar(event);
			}, false);
		}

		document.querySelector("#enlaceMisDatos").click();

		var btnModDatosAlu= document.querySelector("#btnModDatosUsu");
		btnModDatosUsu.addEventListener("click", comprobarFrmModDatosUsu, false);
		//var btnResetModDatosAlu= document.querySelector("#btnResetModDatosAlu");

		oSelectIdioma= document.querySelector("#selectIdioma");
		oSelectIdioma.addEventListener("change", cargarNivel, false);
		oSelectIdioma.addEventListener("change", cargarTipo, false);

		oSelectNivel= document.querySelector("#selectNivel");
		oSelectNivel.addEventListener("change", cargarTipo, false);

		oSelectTipo= document.querySelector("#selectTipo");
		oSelectTipo.addEventListener("change", cargarCurso, false);

		btnAddCursoMatri= document.querySelector("#btnAddCursoMatri");
		btnAddCursoMatri.addEventListener("click", addCursoMatri, false); 

		btnEnviarMatri= document.querySelector("#btnEnviarMatri");
		btnEnviarMatri.addEventListener("click", realizarMatricula, false);

		btnDarBajaAca= document.querySelector("#btnDarBajaAca"); 
		btnDarBajaAca.addEventListener("click", function(oEvento){
			var oE = oEvento || window.event;
			oE.preventDefault();
			academia.borrarUsuario(sesion.dni);
			location.href = "login.html";

		}, false); 


		menuCursoUsuario(); //llamada al método para que cargue los cursos en los que esté inicialmente matriculado

		function menuCursoUsuario()
		{
			var oLiCurso = document.querySelector("#pageSubmenu1");

			borrarLi();

			var oLinkCurso = document.querySelector('a[href="#pageSubmenu1"]');
			var badge = document.createElement("span");
			badge.classList.add("badge");
			badge.id = "numCursos";
			badge.textContent = sesion.listaCursos.length;
			oLinkCurso.appendChild(badge);

			if(sesion.listaCursos.length>0)
			{
				for (var i=0; i<sesion.listaCursos.length; i++) 
				{
					var oCurso = academia.getCurso(sesion.listaCursos[i]);
					var oLi = document.createElement("LI");
					var oA = document.createElement("A");
					oA.href = "#listaCalificaciones";
					oA.textContent = oCurso.idioma+" "+oCurso.nivel;
					oA.id = "enlaceMisCursos";
					oA.value = oCurso.codigo;
					oA.dataset.codigoCurso = oCurso.codigo;
					oLi.appendChild(oA);
					oLiCurso.appendChild(oLi);
					// meterle eventos a los nuevos a creados
					document.querySelectorAll("#enlaceMisCursos")[i].addEventListener("click", function (event) { event.preventDefault(); mostrar(event); this.parentNode.classList.add("active"); }, false);
				}   
			}

			oLinkCurso.appendChild(badge);
		}

		function borrarLi()
		{
			var badge = document.querySelector('#numCursos');
			if (badge != null)
				badge.remove();

			var oLis = document.querySelectorAll("#pageSubmenu1 LI");
			for (var i=0; i<oLis.length; i++) 
			{
				oLis[i].parentNode.removeChild(oLis[i]);
			}
		}

		/* zona para mostrar y ocultar div*/
		function mostrar(oEvento)
		{

			var menus = document.querySelectorAll('nav li');
        	for (var i=0; i<menus.length; i++)
            menus[i].classList.remove('active');

       
			oE= oEvento || window.event;
			if (oE.target.id == "enlaceMisDatos")
			{
				document.getElementById("capaModificarAlu").classList.remove("ocultar");
				document.getElementById("capaMatriCurso").classList.add("ocultar");
				document.getElementById("capaDarBaja").classList.add("ocultar");
				document.getElementById("listaCalificaciones").classList.add("ocultar");
				document.querySelector('#enlaceMisDatos').parentNode.classList.add('active');
				resetearCamposModMatricula();
				cargarDatosUsuario();

			}
			else if (oE.target.id == "enlaceMatricular")
			{
				document.getElementById("capaMatriCurso").classList.remove("ocultar");
				document.getElementById("capaModificarAlu").classList.add("ocultar");
				document.getElementById("capaDarBaja").classList.add("ocultar");
				document.getElementById("listaCalificaciones").classList.add("ocultar");
				document.querySelector('#enlaceMatricular').parentNode.classList.add('active');
				resetearSelectIdiomas();
				cargarCursos();


			}
			else if (oE.target.id == "enlaceBaja")
			{
				document.getElementById("capaDarBaja").classList.remove("ocultar");
				document.getElementById("capaModificarAlu").classList.add("ocultar");
				document.getElementById("capaMatriCurso").classList.add("ocultar");
				document.getElementById("listaCalificaciones").classList.add("ocultar");
				document.querySelector('#enlaceBaja').parentNode.classList.add('active');
			}
			else if (oE.target.id == "enlaceMisCursos")
			{
				document.getElementById("listaCalificaciones").classList.remove("ocultar");
				document.getElementById("capaModificarAlu").classList.add("ocultar");
				document.getElementById("capaMatriCurso").classList.add("ocultar");
				document.getElementById("capaDarBaja").classList.add("ocultar");
				document.querySelector('#pageSubmenu1').parentNode.classList.add('active');
				cargarListadoCurso(oEvento);

			}
		}
	</script>
</body>
</html>